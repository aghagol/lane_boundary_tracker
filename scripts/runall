#!/usr/bin/env bash

while [[ "$#" > 1 ]]; do case $1 in
    --input)  data_dir="$2";;
    --output) cache="$2";;
    *) echo "Usage: runall [--input path/to/data] --output path/to/tmp"; exit 1;;
  esac; shift; shift
done

if [[ -z $cache ]] ; then
  echo "Usage: runall [--input path/to/data] --output path/to/tmp"; exit 1
fi

MOT_CONFIG="./conf.json"

if [[ $data_dir ]] ; then
  if mkdir $cache ; then
    ./scripts/preprocess  --input $data_dir             --output $cache/preprocess  --config $MOT_CONFIG
    ./scripts/sort        --input $cache/preprocess/mot --output $cache/sort        --config $MOT_CONFIG
    ./scripts/postprocess --input $cache/preprocess/mot --output $cache/postprocess --config $MOT_CONFIG  --tracks $cache/sort/tracks
    ./scripts/fuse        --input $cache/preprocess/mot --output $cache/fuse        --config $MOT_CONFIG  --tracks $cache/postprocess/tracks  --input-root $data_dir
    # ./scripts/evaluate    --input $cache/preprocess/mot --output $cache/evaluate    --config $MOT_CONFIG  --tracks $cache/sort/tracks
  else
    echo "Output path is not empty.. Please enter an empty path for outputs."
  fi
fi

echo "Visualize?"
select ans in Yes No
do
  case $ans in
    Yes)
      rm -rf $cache/visualize
      ./scripts/visualize --input $cache/preprocess/mot --output $cache/visualize --config $MOT_CONFIG --tracks $cache/postprocess/tracks;;
  esac
  break
done

